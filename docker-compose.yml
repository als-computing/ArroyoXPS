
version: "3.3"
services:
  tiled:
    # see the file ./tiled/deploy/config.yml for detailed configuration of tiled
    image: ghcr.io/bluesky/tiled:main
    ports:
      - "8000:8000"
    environment:
      - TILED_SINGLE_USER_API_KEY=${TILED_SINGLE_USER_API_KEY}
    volumes:
      - ./services/tiled/deploy:/deploy:Z
      - ./data:/data:Z
    restart: unless-stopped
    networks:
      aps_net:

  processor:
    command: python -m tr_ap_xps.apps.processor_cli --zmq-pub-address tcp://simulator --zmq-pub-port 5555
    build:
      context: .
      dockerfile: Dockerfile_processor
    restart: unless-stopped
    volumes:
      - .:/app:Z
      - ./settings_container.yaml:/app/settings.yaml:Z
    networks:
      aps_net:


  frontend:
    build:
      context: .
      dockerfile: Dockerfile_frontend
    ports:
      - "8080:80"
    restart: unless-stopped
    volumes:
      - .:/app:Z
    networks:
      aps_net:

networks:
  aps_net:
    driver: bridge
